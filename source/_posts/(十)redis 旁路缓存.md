---
title: (十)redis 旁路缓存
date: 2022-11-12 19:59:20
index_img: /img/redis.png
categories:
  - redis
tags:
  - redis
---

### 将 redis 当做旁路缓存使用

在业务客户端和数据库持久层中间,加上 redis,此时 redis 就以旁路缓存的身份提供服务

作为缓存使用的redis 有两种方式

1. 只读缓存
2. 读写缓存

#### 只读缓存

redis 只提供读请求,所有的写请求都直接打到数据库

对于删除操作,当删除数据库的记录后,还需要删除 redis 里面保存的记录,以免下次又从缓存里面读到了

对于读请求,如果没有命中 redis 缓存,则会直接访问数据库,并且回写到 redis 里面,以便下次直接从 redis 里获取数据

![img.png](https://tva1.sinaimg.cn/large/008vK57jgy1h82lz1mtthj30j50acgnw.jpg)

对于只读缓存来说,数据库能够提供数据的可靠性保证,不会有丢失数据的风险; 所以对于那些只读的数据例如图片,短视频等内容,可以考虑使用 redis 作为只读缓存

#### 读写缓存

对于读写缓存来说,redis 不仅仅要处理读请求,现在还负责处理写请求,这样最新的数据都只会在 redis 里面保存; 如果发生异常宕机的话,这些新数据就会因为没有持久化到数据库里导致数据丢失

对于读写缓存来说,有两种配置策略

1. 同步直写: 客户端将写请求发送给 redis 之后,也会发送给数据库进行处理; 等到缓存和数据库都返回处理成功后,才返回给业务端; 这样即使发生宕机,数据库里面也有最新的数据,提供了数据的可靠性保证

同步直写的缺点就是: 由于 redis 和数据库处理数据的速度不同,很可能 redis 在短时间之内就返回了,而等待数据库处理完成后已经过去一段时间; 这无疑增大了请求的整体耗时

3. 异步回写: 客户端将所有写请求都放到缓存里面处理; 等到这些数据即将从缓存里面被淘汰时,redis 将这些最新的数据写回数据库; 这样所有的读写请求都在 redis 处理,客户端可以在很短的时间的回复业务方的请求; 只不过一旦发生异常宕机,那些还没来得及写回数据库的数据就会有丢失的风险了

![img_1.png](https://tva1.sinaimg.cn/large/008vK57jgy1h82lz7158pj30is0a1abo.jpg)