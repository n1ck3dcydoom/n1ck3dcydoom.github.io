---
title: (一)jvm 内存模型
date: 2022-11-15 11:42:55
index_img: /img/java.png
categories:
  - jvm
tags:
  - jvm
---

### jvm 的内存模型

jvm 内存模型由以下几个部分组成

* 方法区 method
* 堆 heap
* 虚拟机栈 vm stack
* 本地方法栈 native method stack
* 程序计数器 program counter (pc)

其中方法区和堆是所有线程共享的,而虚拟机栈,本地方法栈和程序计数器则是每个线程独有的

#### 程序计数器

程序计数器的作用就是标记当前线程执行到的字节码行号; 当时间片轮转导致线程上下文切换或者进入循环分支等流程,都需要通过程序计数器来控制

#### 虚拟机栈

虚拟机栈用于保存,每个方法在运行时 jvm 创建的 `栈帧` ,而 `栈帧` 则是用于保存方法需要的本地变量等信息; 一个方法的执行和返回,就对应了线程里面虚拟机栈 `栈帧` 的入栈和出栈

当虚拟机栈超过一定深度之后,就会引发 `StackOverflow` 异常; 或者申请分配 `栈帧` 时所需要的内存不够,就会引发 `OutOfMemory` 异常

#### 本地方法栈

区域别类里面的方法,本地方法栈保存的是 jvm 需要使用的 `native` 方法

#### 堆

虚拟机里面所有对象的创建都是在堆空间上直接分配的; 包括后面的垃圾回收过程也几乎都是运行在堆空间上

当对空间不足以分配实例的所需的内存是,会引发 `OOM` 异常

#### 方法区

方法区也是所有线程共享的一块区域,里面保存了 jvm 启动时加载的各种静态变量,静态方法,静态实例等; 还有各种常量,类加载信息都会保存在方法区内

与堆进行区分,也称作 `非堆区` 或者叫做 `永久代` ,在后面的 jdk 发展过程当中 `永久代` 慢慢被废弃,直到 `本地内存`  `元空间` 将其完全替代